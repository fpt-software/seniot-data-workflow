<script type="text/x-red" data-template-name="lennox-reg">
	<div class="form-row">
	<label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
	<input type="text" id="node-input-name" placeholder="name">
	</div>
	<div class="form-row">
	<label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
	<input type="text" id="node-input-topic" style="width: 70%x">
	</div>
	<div class="form-row" id="node-input-row-payload">
	<label for="node-input-payload"><i class="fa fa-msg"></i>Payload</label>
	<input type="text" id="node-input-payload" style="width:70%">
	</div>
</script>

<script type="text/x-red" data-help-name="lennox-reg">
	Using this node you can display the status of the device provisioning process to the IoT Hub.<br/>
	<p>This node is work with Lennox Device mangement system.</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('lennox-reg', {
		category : 'display-category',
		color : "darksalmon",
		defaults : {
			name : {
				value : ""
			},
			topic : {
				value : ""
			},
			payload : {
				value : ""
			},
		},
		inputs : 0,
		outputs : 1,
		icon : "arrow-in.png",
		align : "left",
		label : function() {
			return this.name;
		},
		labelStyle : function() {
			return this.name ? "node_label_italic" : "lennox-reg";
		},
		button : {
			onclick : function() {
				var label = (this.name || this.payload).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
				var node = this;
				$.ajax({
					url : "lennox/reg/" + this.id,
					type : "POST",
					success : function(resp) {
						RED.notify(node._("inject.success", {
							label : label
						}), "success");
					},
					error : function(jqXHR, textStatus, errorThrown) {
						if (jqXHR.status == 404) {
							RED.notify(node._("common.notification.error", {
								message : node._("common.notification.errors.not-deployed")
							}), "error");
						} else if (jqXHR.status == 500) {
							RED.notify(node._("common.notification.error", {
								message : node._("inject.errors.failed")
							}), "error");
						} else if (jqXHR.status == 0) {
							RED.notify(node._("common.notification.error", {
								message : node._("common.notification.errors.no-response")
							}), "error");
						} else {
							RED.notify(node._("common.notification.error", {
								message : node._("common.notification.errors.unexpected", {
									status : jqXHR.status,
									message : textStatus
								})
							}), "error");
						}
					}
				});
			}
		}
	}); 
</script>
